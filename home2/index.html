<!-- <script>
    let url = 'https://rau.dev/api/auth';
    fetch(url)
        .then(response => response.json())
        .then(data => {
            if(data.result) {
                document.write('You are logged in')
            }
            else {
                window.location = '/login'
            }
        })
</script> -->

<html>

<head>
    <title>Three.js Plane and Box</title>
    <style>
        body {
            margin: 0;
        }

        /* canvas { width: 100%; height: 100% } */
    </style>
</head>

<body>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/110/three.js"></script>
    <script>

        var width = window.innerWidth;
        var height = window.innerHeight;
        // keyboard camera controls
        var keyboard = {};

        // Create a renderer
        var renderer = new THREE.WebGLRenderer();

        ////////////////////////////////
        // Create a scene
        var scene = new THREE.Scene();

        // Create a camera
        var camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 2000);

        // Skybox color: r: 78, g: 140, b: 255
        scene.background = new THREE.Color(78 / 255, 140 / 255, 255 / 255);

        // camera.position.x = 5;
        // camera.position.y = -5;
        // camera.position.z = -4; //6.8;
        // camera.position.x = 5;
        // camera.position.y = -5.399999999999999;
        // camera.position.z = -8.999999999999982;
        // camera.rotation.x = Math.PI;
        renderer.shadowMap.enabled = true;
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);

        // Create a plane
        var planeGeometry = new THREE.PlaneGeometry(10, 10, 10, 10);
        var planeMaterial = new THREE.MeshPhongMaterial({ color: 0x00ff00, side: THREE.DoubleSide, wireframe: true });
        var plane = new THREE.Mesh(planeGeometry, planeMaterial);
        plane.position.x = 0;
        plane.position.y = 0;
        plane.position.z = -planeGeometry.parameters.height;
        // scene.add(plane);


        // Create a ground: r: 26, g: 187, b: 51
        // var groundGeometry = new THREE.PlaneGeometry(1000, 1000, 1, 1);
        // var groundMaterial = new THREE.MeshPhongMaterial({ color: new THREE.Color(26/255, 187/255, 51/255), side: THREE.DoubleSide, shadowSide: THREE.DoubleSide });
        // var ground = new THREE.Mesh(groundGeometry, groundMaterial);
        // ground.position.x = 0;
        // ground.position.y = -planeGeometry.parameters.height;
        // ground.position.z = 200
        // ground.rotation.x = Math.PI / 2;
        // ground.receiveShadow = true;
        // scene.add(ground);
        var groundGeometry = new THREE.BoxGeometry(1000, 2, 1000);
        var groundMaterial = new THREE.MeshPhongMaterial({ color: new THREE.Color(26 / 255, 187 / 255, 51 / 255) });
        var ground = new THREE.Mesh(groundGeometry, groundMaterial);
        ground.position.x = 0;
        ground.position.y = -planeGeometry.parameters.height;
        ground.position.z = 0
        // ground.rotation.x = Math.PI / 2;
        ground.receiveShadow = true;
        // ground.castShadow = true;
        scene.add(ground);

        // Create the Sun sphere
        var sunGeometry = new THREE.SphereGeometry(150, 32, 32);
        var sunMaterial = new THREE.MeshBasicMaterial({ color: 0xffd65b });
        var sun = new THREE.Mesh(sunGeometry, sunMaterial);
        sun.position.x = 0;
        sun.position.y = -500
        sun.position.z = 400;
        // sun.receiveShadow = true;
        // sun.castShadow = true;
        scene.add(sun);

        // Create the light source
        // var light = new THREE.PointLight(0xffffff, 2, 3000, .001);
        var light = new THREE.SpotLight(0xffffff, 1, 2000, 1, 0, 0);
        light.target.position.set(0, 0, 0);
        light.position.set(0, 15, -200);
        light.castShadow = true;
        light.shadow.camera.near = 0.1;
        light.shadow.camera.far = 4000;
        light.shadow.camera.fov = 10;
        light.shadow.mapSize.width = 20024;
        light.shadow.mapSize.height = 20024;

        scene.add(light);

        // var hlight = new THREE.HemisphereLight(new THREE.Color(78 / 255, 140 / 255, 255 / 255), new THREE.Color(0, 0, 0), 1);
        // scene.add(hlight);


        // Create a test object in front of the camera to cast shadow
        // var testGeometry = new THREE.BoxGeometry(10, 10, 10);
        // var testMaterial = new THREE.MeshPhongMaterial({ color: 0x00ff00 });
        // var test = new THREE.Mesh(testGeometry, testMaterial);
        // test.position.x = 0;
        // test.position.y = 5;
        // test.position.z = -30;
        // test.castShadow = true;
        // test.receiveShadow = true;
        // scene.add(test);



        var loader = new THREE.FontLoader();
        // Retrieve the JSON font file
        fetch('https://raw.githubusercontent.com/mrdoob/three.js/master/examples/fonts/helvetiker_regular.typeface.json')
            .then(response => response.json())
            .then(fontJson => {
                var font = new THREE.Font(fontJson);
                start(font);
            });

        function randomColor() {
            return Math.floor(Math.random() * 16777215);
        }

        function start(font) {

            // Add text to the front of the box
            var textGeometry = new THREE.TextGeometry('Hello World!', {
                font: font,
                size: 10,
                height: 0,
            });

            var textMaterial = new THREE.MeshPhongMaterial({ color: 0xffffff });

            var text = new THREE.Mesh(textGeometry, textMaterial);
            // Scale the text down based on the computed width
            textGeometry.computeBoundingBox();
            text.position.x = -textGeometry.boundingBox.max.x / 2;
            text.position.z = -50;
            text.position.y = 10;
            // text.receiveShadow = true;
            text.castShadow = true;
            scene.add(text);
            animate();
        }

        // Resizing the canvas when the window is resized
        window.addEventListener('resize', function () {
            width = window.innerWidth;
            height = window.innerHeight;
            renderer.setSize(width, height);
            camera.aspect = width / height;
            camera.updateProjectionMatrix();
        });
        window.addEventListener('keydown', function (event) {
            keyboard[event.keyCode] = true;
        });
        window.addEventListener('keyup', function (event) {
            keyboard[event.keyCode] = false;
        });

        var pausesun = false;
        function moveCamera() {
            if (keyboard[87]) { // W key
                camera.position.z -= 11;
            }
            if (keyboard[83]) { // S key
                camera.position.z += 11;
            }
            if (keyboard[65]) { // A key
                camera.position.x -= 11;
            }
            if (keyboard[68]) { // D key
                camera.position.x += 11;
            }
            if (keyboard[81]) { // Q key
                camera.rotation.y += 0.05;
            }
            if (keyboard[69]) { // E key
                camera.rotation.y -= 0.05;
            }
            if (keyboard[32]) { // SPACE key
                camera.position.y += 11;
            }
            if (keyboard[16]) { // SHIFT key
                camera.position.y -= 11;
            }

            // 1 key
            if (keyboard[49]) {
                pausesun = !pausesun;
                keyboard[49] = false;
            }
        }

        // Animation function
        var t = 4;
        function animate() {
            requestAnimationFrame(animate);
            moveCamera();

            // sun.position.y -= 5;

            if(!pausesun) {
                // adjust sun position by rotating in an arc around 0, 0, 0
                sun.position.y = (Math.sin(t) * 700);
                sun.position.z = (Math.cos(t) * 700);
                
                t += .01;
                
                light.position.x = sun.position.x;
                light.position.y = sun.position.y;
                light.position.z = sun.position.z;

                // move the light to a point 50 pixels away from its current position relative to the center 0, 0, 0-
                light.position.x += 100;
                light.position.y += 100;
                light.position.z += 100;


                // set the hemisphere sky color to reflect the suns position
                scene.background = new THREE.Color(78 / 255 * (sun.position.y / 700), 140 / 255 * (sun.position.y / 700), 255 / 255 * (sun.position.y / 700));
                
            }

            renderer.render(scene, camera);
        }
    </script>
</body>

</html>